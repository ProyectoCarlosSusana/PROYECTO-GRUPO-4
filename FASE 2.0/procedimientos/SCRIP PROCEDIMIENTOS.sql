/*PROCEDIMIENTOS

LISTADO DE TODOS LOS TRABAJADORES TODOS LOS CAMPOS
LISTADO DE UN TRABAJADOR POR DNI Y QUE LISTE TODOS LOS CAMPOS
LISTADO DE TODOS LOS CENTROS OUT CURSOR
LISTADO DE UN CENTRO POR NOMBRE
LISTADO DE  TRABAJADORES CON PARTES ABIERTOS
LISTADO DE  TRABAJADORES CON PARTES CERRADOS
*/


--listado de todos los trabajadores:

create or replace procedure LISTATRABAJADORES (LISTA OUT SYS_REFCURSOR)
AS
VACIO EXCEPTION;
MAS_ERRORES EXCEPTION;
BEGIN
OPEN LISTA FOR
SELECT * FROM TRABAJADOR;
EXCEPTION
WHEN NO_DATA_FOUND THEN RAISE VACIO;
WHEN OTHERS THEN RAISE MAS_ERRORES;
END LISTATRABAJADORES;

--LISTADO DE UN TRABAJADOR

CREATE OR REPLACE PROCEDURE LISTARUNTRABAJADOR ( dni_trabajador IN TRABAJADOR.DNI%TYPE, TODO OUT TRABAJADOR%ROWTYPE)
IS
VACIO EXCEPTION;
MAS_ERRORES EXCEPTION;
BEGIN
SELECT * INTO TODO FROM TRABAJADOR WHERE DNI = dni_trabajador;
EXCEPTION
WHEN NO_DATA_FOUND THEN RAISE VACIO;
WHEN OTHERS THEN RAISE MAS_ERRORES;
END LISTARUNTRABAJADOR;

--LISTADO DE TODOS LOS CENTROS 
create or replace procedure LISTACENTROS (LISTAC OUT SYS_REFCURSOR)
AS
VACIO EXCEPTION;
MAS_ERRORES EXCEPTION;
BEGIN
OPEN LISTAC FOR
SELECT * FROM CENTRO;
EXCEPTION
WHEN NO_DATA_FOUND THEN RAISE VACIO;
WHEN OTHERS THEN RAISE MAS_ERRORES;
END LISTACENTROS;

--LISTADO DE UN CENTRO


CREATE OR REPLACE PROCEDURE LISTARUNCENTRO ( NOMBRE_CENTRO IN CENTRO.NOMBRE%TYPE, TODO OUT CENTRO%ROWTYPE)
IS
VACIO EXCEPTION;
MAS_ERRORES EXCEPTION;
BEGIN
SELECT * INTO TODO FROM CENTRO WHERE NOMBRE = NOMBRE_CENTRO;
EXCEPTION
WHEN NO_DATA_FOUND THEN RAISE VACIO;
WHEN OTHERS THEN RAISE MAS_ERRORES;
END LISTARUNCENTRO;


--LISTADO DE  TRABAJADORES CON PARTES ABIERTOS

CREATE OR REPLACE PROCEDURE TRAB_PARTES_ABIERTOS (TRAB_ABIERTOS OUT SYS_REFCURSOR)
IS
VACIO EXCEPTION;
MAS_ERRORES EXCEPTION;
BEGIN
OPEN TRAB_ABIERTOS FOR
SELECT T.USUARIO, T.DNI, T.NOMBRE, T.APELLIDO_1, T.APELLIDO_2, T.CALLE, T.PISO, T.MANO, T.CATEGORIA, T.CENTRO_CENTRO_ID , P.ESTADO FROM TRABAJADOR T, PARTE P
WHERE TRABAJADOR_USUARIO = USUARIO AND P.ESTADO = 'ABIERTO';
EXCEPTION
WHEN NO_DATA_FOUND THEN RAISE VACIO;
WHEN OTHERS THEN RAISE MAS_ERRORES;
END TRAB_PARTES_ABIERTOS;



--LISTADO DE TRABAJADORES CON PARTES CERRADOS

CREATE OR REPLACE PROCEDURE TRAB_PARTES_CERRADOS (TRAB_CERRADOS OUT SYS_REFCURSOR)
IS
VACIO EXCEPTION;
MAS_ERRORES EXCEPTION;
BEGIN
OPEN TRAB_CERRADOS FOR
SELECT T.USUARIO, T.DNI, T.NOMBRE, T.APELLIDO_1, T.APELLIDO_2, T.CALLE, T.PISO, T.MANO, T.CATEGORIA, T.CENTRO_CENTRO_ID, P.ESTADO
FROM TRABAJADOR T, PARTE P
WHERE P.TRABAJADOR_USUARIO = T.USUARIO AND P.ESTADO = 'CERRADO';
EXCEPTION
WHEN NO_DATA_FOUND THEN RAISE VACIO;
WHEN OTHERS THEN RAISE MAS_ERRORES;
END TRAB_PARTES_CERRADOS;





